"use strict";import{jsx as s,jsxs as p}from"react/jsx-runtime";import{useCallback as o,useEffect as P,useMemo as t,useRef as W,useState as q}from"react";import{createPortal as G}from"react-dom";import{KIcon as J}from"../../components";import{initSize as Q}from"../../common/util/variation";import{useCleanId as U}from"../../common/hook/useCleanId";const V="k-modal-test-id",X="k-modal__header-test-id",Y="k-modal__container-test-id",Z="k-modal__close-button-test-id";function O({...$}){const{id:K,style:T,isOpen:f,onClose:r,title:d,content:u,footer:i,size:y,className:k,isOverlay:v=!0,overlayOpacity:c,overlayClosable:h,headerClass:C="",contentClass:w,footerClass:b,escClosable:n=!1,width:m}={...$},N=W(null),[j,I]=q(!1),l=U("k-modal-header-title"),z=t(()=>{const e=[];return Q(e,"k-modal__container",y),k&&e.push(k),e.join(" ")},[y]),E=t(()=>v?"k-modal-wrapper__overlay--active":"k-modal-wrapper__overlay--transparent",[v]),L=t(()=>{const e={};return m&&(e.width=m),e},[m]),S=t(()=>{const e={};return c&&(e.opacity=c.toString()),e},[c]),M=o(()=>{N.current?.classList.add("k-modal__wrapper--close")},[]),a=o(()=>{M(),setTimeout(()=>{r(),I(!1)},160)},[M]),g=o(()=>{I(!0)},[]),_=o(()=>{a()},[r,a]),R=o(()=>{h&&a()},[r,h]),x=o(e=>{e.keyCode===27&&a()},[a]),A=o(()=>{n&&window.addEventListener("keydown",x)},[n]),B=o(()=>{n&&window.addEventListener("keydown",x)},[n]);P(()=>(f?(g(),A()):_(),()=>B()),[f]);const D=t(()=>p("div",{className:`k-modal__container__header ${C}`,"data-testid":X,children:[s("h1",{id:l,className:"k-modal__container__header__text",children:d}),s(J,{className:"k-modal__container__header__close-button",icon:"close",size:16,onClick:_})]}),[C,d,_,l,Z]),F=t(()=>s("section",{className:`k-modal__container__content${w?` ${w}`:""}`,"aria-labelledby":l,children:u}),[u,l]),H=t(()=>i&&s("div",{className:`k-modal__container__footer ${b}`,children:i}),[i,b]);return j?G(p("div",{ref:N,id:K,className:"k-modal__wrapper",style:T,role:"dialog",tabIndex:-1,"aria-modal":"true","aria-label":`${d}-modal-wrapper`,"data-testid":V,children:[p("div",{className:`k-modal__container ${z}`,style:L,"data-testid":Y,children:[D,F,H]}),s("div",{style:S,className:`k-modal-wrapper__overlay ${E}`,onClick:R,"aria-hidden":"true"})]}),document.body):null}O.displayName="KModal";export default O;
